# ========================================
# RunPod Deployment: Python Video API (GPU)
# ========================================
# Docker Hub YOK - Local build + Volume mount
# GPU destekli FFmpeg (NVENC)

services:
  video-api:
    build:
      context: ./yt-video
      dockerfile: Dockerfile.gpu
    ports:
      - "8000:8000"
    volumes:
      # Kod değişiklikleri için - rebuild gerekmez
      - ./yt-video/api:/app/api
      # Geçici dosyalar için
      - ./temp:/app/temp
    environment:
      - PYTHON_API_PORT=8000
      - R2_ACCOUNT_ID=${R2_ACCOUNT_ID}
      - R2_ENDPOINT=${R2_ENDPOINT}
      - R2_ACCESS_KEY_ID=${R2_ACCESS_KEY_ID}
      - R2_SECRET_ACCESS_KEY=${R2_SECRET_ACCESS_KEY}
      - R2_BUCKET_NAME=${R2_BUCKET_NAME}
      - R2_PUBLIC_URL=${R2_PUBLIC_URL}
      - FAL_KEY=${FAL_KEY}
      - NODE_CALLBACK_URL=${NODE_CALLBACK_URL}
      - IMAGEMAGICK_BINARY=/usr/bin/convert
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    restart: unless-stopped
